{% extends "core/seshat-base.html" %}
{% load leaflet_tags %}

<head>
    {% leaflet_js %}
    {% leaflet_css %}
</head>

<body>
    {% block content %}
    <div style="display: flex;">
        <div>
            <fieldset>
                <legend>
                    <h3>Base Map</h3>
                </legend>
                <label><input type="radio" name="baseMap" value="carto" onclick="switchBaseMap()"checked>CartoDB</label><br>
                <label><input type="radio" name="baseMap" value="osm" onclick="switchBaseMap()">OpenStreetMap</label><br>
            </fieldset>
            <div id="dateDropdowns" style="margin-top: 20px;">
                <fieldset>
                    <legend>
                        <h3>Date Range</h3>
                    </legend>
                    <label for="startYear">Start Year:</label>
                    <select name="startYear" id="startYear">
                        {% for shape in shapes %}
                            {% if 'BCE' in shape.date_from %}
                                {% with start_year=shape.date_from|slice:":-3"|add:"0" %}
                                    <option value="{{ start_year }}">{{ start_year }}</option>
                                {% endwith %}
                            {% else %}
                                {% with start_year=shape.date_from|slice:":-2"|add:"0" %}
                                    <option value="{{ start_year }}">{{ start_year }}</option>
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </select><br>

                    <label for="endYear">End Year:</label>
                    <select name="endYear" id="endYear">
                        {% for shape in shapes %}
                            {% if 'BCE' in shape.date_to %}
                                {% with end_year=shape.date_to|slice:":-3"|add:"0" %}
                                    <option value="{{ end_year }}">{{ end_year }}</option>
                                {% endwith %}
                            {% else %}
                                {% with end_year=shape.date_to|slice:":-2"|add:"0" %}
                                    <option value="{{ end_year }}">{{ end_year }}</option>
                                {% endwith %}
                            {% endif %}
                        {% endfor %}
                    </select><br>
                </fieldset>
            </div>
        </div>
        <div id="map" style="height: 75vh; flex: 1;"></div>
    </div>
    <div id="map" style="height: 75vh;"></div>
    {% leaflet_map "map" %}
    <script>
        var map = L.map('map').setView([0, 0], 2);
        var baseLayers = {
            "carto": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png'),
            "osm": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
        };
        var currentLayer = baseLayers.carto.addTo(map);

        function switchBaseMap() {
            var selectedMap = document.querySelector('input[name="baseMap"]:checked').value;
            map.removeLayer(currentLayer);
            currentLayer = baseLayers[selectedMap].addTo(map);
        }

        function filterByYearRange() {
            var startYear = document.getElementById('startYear').value;
            var endYear = document.getElementById('endYear').value;
        }

        {% for shape in shapes %}
        var geoJSONLayer = L.geoJSON({{ shape.geom.geojson | safe }}).addTo(map);
        {% endfor %}
    </script>
    {% endblock %}
</body>