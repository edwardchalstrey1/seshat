{% extends "core/seshat-base.html" %}
{% load leaflet_tags %}

<head>
    {% leaflet_js %}
    {% leaflet_css %}
</head>

<body>
    {% block content %}
    <div style="display: flex;">
        <div>
            <fieldset>
                <legend>
                    <h3>Base Map</h3>
                </legend>
                <label><input type="radio" name="baseMap" value="carto" onclick="switchBaseMap()" checked>CartoDB</label><br>
                <label><input type="radio" name="baseMap" value="osm" onclick="switchBaseMap()">OpenStreetMap</label><br>
                <label><input type="radio" name="baseMap" value="stamen" onclick="switchBaseMap()"> Stamen</label><br>
            </fieldset>
        </div>
        <div id="map" style="height: 75vh; flex: 1;"></div>
    </div>

    <script>
        var baseMaps = {
            "CartoDB": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: '© OpenStreetMap contributors, © CartoDB'
            }),
            "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }),
            "Stamen": L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.jpg', {
                maxZoom: 18,
                attribution: '© Stamen Design'
            })
        };

        var map = L.map('map', {
            center: [0, 0],
            zoom: 2,
            layers: [baseMaps.CartoDB]
        });

        var currentLayer = baseMaps.CartoDB.addTo(map);

        function switchBaseMap() {
            var selectedMap = document.querySelector('input[name="baseMap"]:checked').value;
            map.removeLayer(currentLayer);
            currentLayer = baseMaps[selectedMap].addTo(map);
        }

        // Display the GeoJSON shapes
        {% for shape in shapes %}
        L.geoJSON({{ shape.geom.geojson | safe }}).addTo(map);
        {% endfor %}
    </script>
    {% endblock %}
</body>